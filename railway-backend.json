{
  "$schema": "https://schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "pip install -r requirements.txt && python -m alembic upgrade head",
    "watchPatterns": [
      "backend/**"
    ]
  },
  "deploy": {
    "startCommand": "cd backend && python -m gunicorn --bind 0.0.0.0:$PORT --workers 4 --timeout 120 app:app",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 3
  },
  "environments": {
    "production": {
      "variables": {
        "NODE_ENV": "production",
        "FLASK_ENV": "production",
        "DEBUG": "false",
        "DATABASE_URL": "${{NEON_DATABASE_URL}}",
        "SECRET_KEY": "${{SECRET_KEY}}",
        "JWT_SECRET_KEY": "${{JWT_SECRET_KEY}}",
        "JWT_ACCESS_TOKEN_EXPIRES": "3600",
        "JWT_REFRESH_TOKEN_EXPIRES": "2592000",
        "ENCRYPTION_KEY": "${{ENCRYPTION_KEY}}",
        "REDIS_URL": "${{REDIS_URL}}",
        "OPENAI_API_KEY": "${{OPENAI_API_KEY}}",
        "ANTHROPIC_API_KEY": "${{ANTHROPIC_API_KEY}}",
        "GOOGLE_AI_API_KEY": "${{GOOGLE_AI_API_KEY}}",
        "AWS_ACCESS_KEY_ID": "${{AWS_ACCESS_KEY_ID}}",
        "AWS_SECRET_ACCESS_KEY": "${{AWS_SECRET_ACCESS_KEY}}",
        "AWS_REGION": "us-east-1",
        "S3_BUCKET_NAME": "${{S3_BUCKET_NAME}}",
        "SMTP_SERVER": "${{SMTP_SERVER}}",
        "SMTP_PORT": "587",
        "SMTP_USERNAME": "${{SMTP_USERNAME}}",
        "SMTP_PASSWORD": "${{SMTP_PASSWORD}}",
        "FROM_EMAIL": "${{FROM_EMAIL}}",
        "TWILIO_ACCOUNT_SID": "${{TWILIO_ACCOUNT_SID}}",
        "TWILIO_AUTH_TOKEN": "${{TWILIO_AUTH_TOKEN}}",
        "TWILIO_PHONE_NUMBER": "${{TWILIO_PHONE_NUMBER}}",
        "STRIPE_PUBLISHABLE_KEY": "${{STRIPE_PUBLISHABLE_KEY}}",
        "STRIPE_SECRET_KEY": "${{STRIPE_SECRET_KEY}}",
        "STRIPE_WEBHOOK_SECRET": "${{STRIPE_WEBHOOK_SECRET}}",
        "SENTRY_DSN": "${{SENTRY_DSN}}",
        "LOG_LEVEL": "INFO",
        "RATE_LIMIT_PER_MINUTE": "60",
        "RATE_LIMIT_PER_HOUR": "1000",
        "MAX_FILE_SIZE": "10485760",
        "ALLOWED_FILE_TYPES": "jpg,jpeg,png,pdf,mp4,mov,avi",
        "CORS_ORIGINS": "${{CORS_ORIGINS}}",
        "SESSION_LIFETIME": "7200",
        "BACKUP_ENABLED": "true",
        "BACKUP_FREQUENCY": "6h",
        "BACKUP_RETENTION_DAYS": "30"
      }
    }
  },
  "regions": ["us-east-1"],
  "services": [
    {
      "name": "fisioflow-backend",
      "source": {
        "type": "repo",
        "repo": "your-github-repo",
        "branch": "main"
      }
    }
  ]
}